INSERT INTO members (name, email, member_type, joined_at) VALUES
('Juan Pérez', 'juan.perez@email.com', 'standard', '2024-01-15'),
('María García', 'maria.garcia@email.com', 'premium', '2024-02-20'),
('Carlos López', 'carlos.lopez@email.com', 'student', '2024-03-10'),
('Ana Martínez', 'ana.martinez@email.com', 'senior', '2024-01-05'),
('Luis Rodríguez', 'luis.rodriguez@email.com', 'standard', '2024-04-12'),
('Carmen Fernández', 'carmen.fernandez@email.com', 'premium', '2024-02-28'),
('José González', 'jose.gonzalez@email.com', 'student', '2024-05-18'),
('Laura Sánchez', 'laura.sanchez@email.com', 'standard', '2024-01-22'),
('Miguel Díaz', 'miguel.diaz@email.com', 'senior', '2024-03-30'),
('Isabel Torres', 'isabel.torres@email.com', 'premium', '2024-04-05'),
('Pedro Ramírez', 'pedro.ramirez@email.com', 'student', '2024-02-14'),
('Sofía Flores', 'sofia.flores@email.com', 'standard', '2024-06-01'),
('David Morales', 'david.morales@email.com', 'premium', '2024-01-10'),
('Elena Castro', 'elena.castro@email.com', 'student', '2024-03-25'),
('Antonio Ortiz', 'antonio.ortiz@email.com', 'senior', '2024-04-18'),
('Lucía Romero', 'lucia.romero@email.com', 'standard', '2024-02-08'),
('Francisco Navarro', 'francisco.navarro@email.com', 'premium', '2024-05-12'),
('Patricia Ruiz', 'patricia.ruiz@email.com', 'student', '2024-01-28'),
('Javier Jiménez', 'javier.jimenez@email.com', 'standard', '2024-06-15'),
('Rosa Muñoz', 'rosa.munoz@email.com', 'senior', '2024-03-05'),
('Manuel Álvarez', 'manuel.alvarez@email.com', 'premium', '2024-04-22'),
('Teresa Gómez', 'teresa.gomez@email.com', 'student', '2024-02-17'),
('Ramón Herrera', 'ramon.herrera@email.com', 'standard', '2024-05-08'),
('Pilar Medina', 'pilar.medina@email.com', 'premium', '2024-01-19'),
('Alberto Vargas', 'alberto.vargas@email.com', 'student', '2024-06-20'),
('Dolores Ramos', 'dolores.ramos@email.com', 'senior', '2024-03-15'),
('Fernando Gil', 'fernando.gil@email.com', 'standard', '2024-04-30'),
('Cristina Serrano', 'cristina.serrano@email.com', 'premium', '2024-02-25'),
('Ricardo Campos', 'ricardo.campos@email.com', 'student', '2024-05-22'),
('Mercedes Vega', 'mercedes.vega@email.com', 'standard', '2024-01-12');


INSERT INTO books (title, author, category, isbn) VALUES
('Cien años de soledad', 'Gabriel García Márquez', 'Ficción', '978-0307474728'),
('El principito', 'Antoine de Saint-Exupéry', 'Ficción', '978-0156012195'),
('1984', 'George Orwell', 'Ciencia Ficción', '978-0451524935'),
('Don Quijote de la Mancha', 'Miguel de Cervantes', 'Clásicos', '978-8420412146'),
('El código Da Vinci', 'Dan Brown', 'Misterio', '978-0307474278'),
('Harry Potter y la piedra filosofal', 'J.K. Rowling', 'Fantasía', '978-8498383447'),
('Sapiens', 'Yuval Noah Harari', 'Historia', '978-0062316097'),
('El alquimista', 'Paulo Coelho', 'Ficción', '978-0062315007'),
('Rayuela', 'Julio Cortázar', 'Ficción', '978-8437604572'),
('La sombra del viento', 'Carlos Ruiz Zafón', 'Misterio', '978-0143034902'),
('Orgullo y prejuicio', 'Jane Austen', 'Clásicos', '978-0141439518'),
('El hobbit', 'J.R.R. Tolkien', 'Fantasía', '978-0547928227'),
('Breve historia del tiempo', 'Stephen Hawking', 'Ciencia', '978-0553380163'),
('Los juegos del hambre', 'Suzanne Collins', 'Ciencia Ficción', '978-0439023481'),
('La casa de los espíritus', 'Isabel Allende', 'Ficción', '978-1501117015'),
('El señor de los anillos', 'J.R.R. Tolkien', 'Fantasía', '978-0544003415'),
('Crónica de una muerte anunciada', 'Gabriel García Márquez', 'Ficción', '978-1400034956'),
('El arte de la guerra', 'Sun Tzu', 'Filosofía', '978-1599869773'),
('La metamorfosis', 'Franz Kafka', 'Clásicos', '978-0553213690'),
('Fahrenheit 451', 'Ray Bradbury', 'Ciencia Ficción', '978-1451673319'),
('El perfume', 'Patrick Süskind', 'Ficción', '978-0375725845'),
('Los miserables', 'Victor Hugo', 'Clásicos', '978-0451419439'),
('El nombre de la rosa', 'Umberto Eco', 'Misterio', '978-0156001311'),
('El retrato de Dorian Gray', 'Oscar Wilde', 'Clásicos', '978-0141439570'),
('Dune', 'Frank Herbert', 'Ciencia Ficción', '978-0441172719'),
('Steve Jobs', 'Walter Isaacson', 'Biografía', '978-1451648546'),
('El hombre en busca de sentido', 'Viktor Frankl', 'Psicología', '978-0807014295'),
('Padre rico padre pobre', 'Robert Kiyosaki', 'Finanzas', '978-1612680194'),
('La chica del tren', 'Paula Hawkins', 'Misterio', '978-1594634024'),
('El juego de Ender', 'Orson Scott Card', 'Ciencia Ficción', '978-0812550702'),
('Crimen y castigo', 'Fiódor Dostoyevski', 'Clásicos', '978-0486415871'),
('Los pilares de la Tierra', 'Ken Follett', 'Ficción Histórica', '978-0451166890'),
('La catedral del mar', 'Ildefonso Falcones', 'Ficción Histórica', '978-0452289765'),
('El amor en los tiempos del cólera', 'Gabriel García Márquez', 'Ficción', '978-0307389732'),
('Matar a un ruiseñor', 'Harper Lee', 'Clásicos', '978-0061120084'),
('El guardian entre el centeno', 'J.D. Salinger', 'Ficción', '978-0316769174'),
('La carretera', 'Cormac McCarthy', 'Ficción', '978-0307387899'),
('Pedro Páramo', 'Juan Rulfo', 'Ficción', '978-0802133908'),
('Ficciones', 'Jorge Luis Borges', 'Ficción', '978-0802130303'),
('El gran Gatsby', 'F. Scott Fitzgerald', 'Clásicos', '978-0743273565');


INSERT INTO copies (book_id, barcode, status) 
SELECT 
    b.id,
    'COPY-' || LPAD(b.id::text, 3, '0') || '-' || LPAD(gs.n::text, 2, '0'),
    CASE 
        WHEN random() < 0.6 THEN 'available'
        WHEN random() < 0.85 THEN 'loaned'
        WHEN random() < 0.95 THEN 'maintenance'
        ELSE 'lost'
    END
FROM books b
CROSS JOIN generate_series(1, CASE WHEN b.id <= 15 THEN 3 WHEN b.id <= 30 THEN 2 ELSE 1 END) AS gs(n);


INSERT INTO loans (copy_id, member_id, loaned_at, due_at, returned_at)
SELECT 
    c.id,
    (random() * 29 + 1)::integer,
    CURRENT_DATE - interval '120 days' + (random() * 60)::integer * interval '1 day',
    CURRENT_DATE - interval '120 days' + (random() * 60 + 14)::integer * interval '1 day',
    CURRENT_DATE - interval '120 days' + (random() * 60 + 10)::integer * interval '1 day'
FROM copies c
WHERE c.status IN ('available', 'loaned')
ORDER BY random()
LIMIT 40;


INSERT INTO loans (copy_id, member_id, loaned_at, due_at, returned_at)
SELECT 
    c.id,
    (random() * 29 + 1)::integer,
    CURRENT_DATE - interval '60 days' + (random() * 30)::integer * interval '1 day',
    CURRENT_DATE - interval '60 days' + (random() * 30 + 14)::integer * interval '1 day',
    CURRENT_DATE - interval '60 days' + (random() * 30 + 20)::integer * interval '1 day'
FROM copies c
WHERE c.status IN ('available', 'loaned')
AND c.id NOT IN (SELECT copy_id FROM loans)
ORDER BY random()
LIMIT 30;


INSERT INTO loans (copy_id, member_id, loaned_at, due_at, returned_at)
SELECT 
    c.id,
    (random() * 29 + 1)::integer,
    CURRENT_DATE - (random() * 7)::integer * interval '1 day',
    CURRENT_DATE + (7 + random() * 7)::integer * interval '1 day',
    NULL
FROM copies c
WHERE c.status = 'loaned'
AND c.id NOT IN (SELECT copy_id FROM loans)
ORDER BY random()
LIMIT 20;


INSERT INTO loans (copy_id, member_id, loaned_at, due_at, returned_at)
SELECT 
    c.id,
    (random() * 29 + 1)::integer,
    CURRENT_DATE - (20 + random() * 25)::integer * interval '1 day',
    CURRENT_DATE - (3 + random() * 20)::integer * interval '1 day',
    NULL
FROM copies c
WHERE c.status = 'loaned'
AND c.id NOT IN (SELECT copy_id FROM loans)
ORDER BY random()
LIMIT 30;


INSERT INTO fines (loan_id, amount, paid_at)
SELECT 
    l.id,
    GREATEST((EXTRACT(DAY FROM l.returned_at - l.due_at) * 2.50), 5.00),
    CASE 
        WHEN random() < 0.5 THEN l.returned_at + interval '3 days'
        ELSE NULL
    END
FROM loans l
WHERE l.returned_at IS NOT NULL 
AND l.returned_at > l.due_at;


INSERT INTO fines (loan_id, amount, paid_at)
SELECT 
    l.id,
    GREATEST((EXTRACT(DAY FROM CURRENT_DATE - l.due_at) * 2.50), 5.00),
    NULL
FROM loans l
WHERE l.returned_at IS NULL 
AND l.due_at < CURRENT_DATE;


UPDATE copies c
SET status = 'loaned'
WHERE c.id IN (
    SELECT copy_id 
    FROM loans 
    WHERE returned_at IS NULL
);

UPDATE copies c
SET status = 'available'
WHERE c.id NOT IN (
    SELECT copy_id 
    FROM loans 
    WHERE returned_at IS NULL
)
AND c.status = 'loaned';